#!/usr/bin/env python3
'''
Script to be used on the command line, it uses the first 
argument to search for modules on pypi websearch
Depends on BeautifulSoup4
'''

from bs4 import BeautifulSoup as soup
import requests, sys

def pypi_search_help():
    print('''
Usage:  pypi_search STRING
        pypi_search [OPTION]

--help                      prints this help
''')

def main():
    # Exits if no argument was used
    if len(sys.argv) < 2:
        print('\nEmpty search string.\n')
        pypi_search_help()
        exit()
    
    # Makes the request for the html with the search results
    searchurl = 'https://pypi.org/search/?q=' + sys.argv[1]
    pypisoup = soup(requests.get(searchurl).content, 'html.parser')
    pypi_search_results = pypisoup.find_all(class_="package-snippet")
    
    # If nothing is found prints and exit
    if not pypi_search_results: 
        print('\nNo result found\n')
    
    else:
        print()
        for result in pypi_search_results[:5]:
            print(result.find(class_='package-snippet__name').text, end=' ')
            print(result.find(class_='package-snippet__version').text)
            print('\t',result.find(class_='package-snippet__description').text,'\n')

if __name__ == '__main__':

    main()

